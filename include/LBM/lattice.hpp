
#include "header.hpp"
#include "LBM_node.hpp"

class LBM_node;

class lattice{

    protected:

    const int num_dir = 19;
    int* mesh_size_;
    double* domain_size_;
    double dt_;
    double c, origin[3];
    int num_nodes;

    std::vector<std::shared_ptr<LBM_node>> node_lst_ = {};
    static constexpr double evector[19][19] = { {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1}, // Mass Density, \rho
					       {0, 1,-1, 0, 0, 0, 0, 0, 0, 0, 0, 1,-1,-1, 1, 1,-1, 1,-1},  // X-Velocity Density, v_x
					       {0, 0, 0, 1,-1, 0, 0, 1,-1, 1,-1, 0, 0, 0, 0, 1,-1,-1, 1},  // Y-Velocity Density, v_y
					       {0, 0, 0, 0, 0, 1,-1, 1,-1,-1, 1, 1,-1, 1,-1, 0, 0, 0, 0},  // Z-Velocity Density, v_z
					      {-1, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},  // Kinetic Energy, e
					       {0, 2, 2,-1,-1,-1,-1,-2,-2,-2,-2, 1, 1, 1, 1, 1, 1, 1, 1},  // P_xx
					       {0, 0, 0, 1, 1,-1,-1, 0, 0, 0, 0,-1,-1,-1,-1, 1, 1, 1, 1},  // P_ww = P_yy - P_zz
					       {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1,-1,-1},  // P_xy
					       {0, 0, 0, 0, 0, 0, 0, 1, 1,-1,-1, 0, 0, 0, 0, 0, 0, 0, 0},  // P_yz
					       {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1,-1,-1, 0, 0, 0, 0},  // P_zx
					       {0,-2, 2, 0, 0, 0, 0, 0, 0, 0, 0, 1,-1,-1, 1, 1,-1, 1,-1},  // Ghost Moments
					       {0, 0, 0,-2, 2, 0, 0, 1,-1, 1,-1, 0, 0, 0, 0, 1,-1,-1, 1},  //      |
					       {0, 0, 0, 0, 0,-2, 2, 1,-1,-1, 1, 1,-1, 1,-1, 0, 0, 0, 0},  //      |
					       {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,-1, 1, 1,-1, 1,-1, 1,-1},  //      |
					       {0, 0, 0, 0, 0, 0, 0, 1,-1, 1,-1, 0, 0, 0, 0,-1, 1, 1,-1},  //      |
					       {0, 0, 0, 0, 0, 0, 0,-1, 1, 1,-1, 1,-1, 1,-1, 0, 0, 0, 0},  //      |
					       {1,-2,-2,-2,-2,-2,-2, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},  //      |
					       {0,-2,-2, 1, 1, 1, 1,-2,-2,-2,-2, 1, 1, 1, 1, 1, 1, 1, 1},  //      V
					       {0, 0, 0,-1,-1, 1, 1, 0, 0, 0, 0,-1,-1,-1,-1, 1, 1, 1, 1} };//

static constexpr double inv_evector[19][19] ={ {48,  0,  0,  0,-72, 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 24,  0,  0},  // 
                                               { 8, 24,  0,  0,  0,12,  0,  0,  0,  0,-24,  0,  0,  0,  0,  0, -8,-12,  0},  // 
                                               { 8,-24,  0,  0,  0,12,  0,  0,  0,  0, 24,  0,  0,  0,  0,  0, -8,-12,  0},  // 
                                               { 8,  0, 24,  0,  0,-6, 18,  0,  0,  0,  0,-24,  0,  0,  0,  0, -8,  6,-18},  // 
                                               { 8,  0,-24,  0,  0,-6, 18,  0,  0,  0,  0, 24,  0,  0,  0,  0, -8,  6,-18},  // 
                                               { 8,  0,  0, 24,  0,-6,-18,  0,  0,  0,  0,  0,-24,  0,  0,  0, -8,  6, 18},  // 
                                               { 8,  0,  0,-24,  0,-6,-18,  0,  0,  0,  0,  0, 24,  0,  0,  0, -8,  6, 18},  // 
                                               { 4,  0, 12, 12,  6,-6,  0,  0, 36,  0,  0,  6,  6,  0, 18,-18,  2, -6,  0},  // 
                                               { 4,  0,-12,-12,  6,-6,  0,  0, 36,  0,  0, -6, -6,  0,-18, 18,  2, -6,  0},  //
                                               { 4,  0, 12,-12,  6,-6,  0,  0,-36,  0,  0,  6, -6,  0, 18, 18,  2, -6,  0},  // 
                                               { 4,  0,-12, 12,  6,-6,  0,  0,-36,  0,  0, -6,  6,  0,-18,-18,  2, -6,  0},  //
                                               { 4, 12,  0, 12,  6, 3, -9,  0,  0, 36,  6,  0,  6,-18,  0, 18,  2,  3, -9},  //      
                                               { 4,-12,  0,-12,  6, 3, -9,  0,  0, 36, -6,  0, -6, 18,  0,-18,  2,  3, -9},  //      
                                               { 4,-12,  0, 12,  6, 3, -9,  0,  0,-36, -6,  0,  6, 18,  0, 18,  2,  3, -9},  //      
                                               { 4, 12,  0,-12,  6, 3, -9,  0,  0,-36,  6,  0, -6,-18,  0,-18,  2,  3, -9},  //      
                                               { 4, 12, 12,  0,  6, 3,  9, 36,  0,  0,  6,  6,  0, 18,-18,  0,  2,  3,  9},  //      
                                               { 4,-12,-12,  0,  6, 3,  9, 36,  0,  0, -6, -6,  0,-18, 18,  0,  2,  3,  9},  //      
                                               { 4, 12,-12,  0,  6, 3,  9,-36,  0,  0,  6, -6,  0, 18, 18,  0,  2,  3,  9},  //      
                                               { 4,-12, 12,  0,  6, 3,  9,-36,  0,  0, -6,  6,  0,-18,-18,  0,  2,  3,  9} };//

static constexpr int c_i[19][3] = { { 0, 0, 0},  // 0
				    { 1, 0, 0},  // 1 
                                    {-1, 0, 0},  // 2 
                                    { 0, 1, 0},  // 3 
                                    { 0,-1, 0},  // 4 
                                    { 0, 0, 1},  // 5 
                                    { 0, 0,-1},  // 6 
                                    { 0, 1, 1},  // 7 
                                    { 0,-1,-1},  // 8 
                                    { 0, 1,-1},  // 9 
                                    { 0,-1, 1},  // 10 
                                    { 1, 0, 1},  // 11 
                                    {-1, 0,-1},  // 12 
                                    {-1, 0, 1},  // 13 
                                    { 1, 0,-1},  // 14 
                                    { 1, 1, 0},  // 15 
                                    {-1,-1, 0},  // 16 
                                    {-1, 1, 0},  // 17 
				    { 1,-1, 0} }; // 18


    friend class LBM_node;

    public:

    lattice() = delete;                         //default constructor
    lattice(const lattice& c) = default;           //copy constructor
    lattice(lattice&& c) = delete;                 //move constructor
    lattice& operator=(const lattice& c) = delete; //copy assignment operator
    lattice& operator=(lattice&& c) = delete;      //move assignment operator 


    lattice( double domain_size[3], 
	int mesh_size[3], 
	double dt );

    auto& get_nodes(){return node_lst_;};
    auto get_evector(int i, int j){return evector[i][j];};

    int bd_flip(int i, int j){

	int flip_c[3];

	for(int k=0;k<3;k++){flip_c[k] = -1*c_i[i][k];}

	//flip_c[j] = -1*flip_c[j];

	for(int ii=1; ii<19; ii++){
        	for(int jj=0; jj<3; jj++){
                	if(c_i[ii][jj] == flip_c[jj]);
                	else break;
                	if(jj==2) return ii;
        	}
    	    }
	return -1;
	}

    void stream();

};

